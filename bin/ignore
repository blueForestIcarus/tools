#!/bin/bash
#Adapted from: http://www.zephyrizing.net/presentations/reimplementing-gitignore-in-15-lines-of-bash/ 
#TODO rewrite in haskell
FILENAME=${1-".hgignore"}
DEFAULT=${2-""}
{
	find . -type f
	{
		find . -type f -name $FILENAME -print0 | xargs -0 -n1 -r dirname |
		while read dir
		do
			sed 's|^|'"$dir/"'|' "$dir"/$FILENAME
		done
		[ -z "$DEFAULT" ] || cat $DEFAULT 
	} | xargs -I {} find . -type f -path {}	
} | sort | uniq -u | cut -c3-

